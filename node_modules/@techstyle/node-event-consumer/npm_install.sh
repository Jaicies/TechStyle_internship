#!/bin/bash
if [ -f "yarn.lock" ]; then
   echo "running yarn install"
   echo $1
   if [ -n "$1" ]; then cd "$1"; fi
   pwd
   yarn install --network-concurrency 1
else
   echo "running npm install..."
   if [ -n "$1" ]; then cd "$1"; fi
   npm install
fi

if [ ! -z "$2" ]; then echo "v"`cat package.json | jq -r '.version' | less`-${2} > tmp.var; fi 

if [ ! -z "$2" ]; then npm -f --no-git-tag-version version `cat tmp.var`; fi 

# Publish
npm publish --registry https://registry.techstyle.net/repository/npm-hosted/