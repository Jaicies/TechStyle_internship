# Overview
Internal node package for Kafka event consumer.

## Usage
To use this node package:
1. Verify that your node project has access to the internal Nexus repo to download `@techstyle` packages. This can be achieved by adding a `.npmrc` file to the root directory of your project. The `.npmrc` file should include these lines to receive `@techstyle` internally published packages.
```
@techstyle:registry=https://registry.techstyle.net/repository/npm-all/
@techstyle:strict-ssl=false
```
2. Install the `@techstyle/node-event-consumer` package (i.e. `npm install @techstyle/node-event-consumer --save`)
3. Example usage:
```
const EventConsumer = require('@techstyle/node-event-consumer');

const brokerList = [
  'tfgelsvmlxkfa03.corp.brandideas.com:9092',
  'tfgelsvmlxkfa04.corp.brandideas.com:9092',
  'tfgelsvmlxkfa05.corp.brandideas.com:9092',
];
const caFilePath = 'location-of-ca.crt';

const eventConsumer = new EventConsumer(
  brokerList,
  'test',
  'production',
  caFilePath,
);

const consumerCallback = async ({topic, partition, message}) => {
  console.log({
    topic,
    partition,
    offset: message.offset,
    value: message.value.toString(),
  });
};

eventConsumer.subscribeToEachMessage('testGroupId', 'echo-test', true, consumerCallback);

```

## Publishing to Nexus
1. Bump the version in package.json
2. Run the [TFG-Publish-To-Nexus-Registry Jenkins Job] with `GIT_REPO=ssh://git@git.justfab.net/svc/node-event-consumer.git` and `GIT_REF=<branch_to_publish>` ([docs])
3. Verify the published version at `https://registry.techstyle.net/`

## Contributing Guidelines
If any changes need to be made to this package, consult Fission first.
1. Create a feature branch from the master branch in [node-event-consumer] with the naming convention `feature/<JIRA_TICKET_NUMBER>-description`.
2. The linter runs pre-commit, so core syntax standards are maintained.
3. Submit a Pull Request against the master branch in [node-event-consumer] with [Alexis Emperador], [Bryan Galaz] and [Ed Galarza] as reviewers.
4. Once Pull Request is approved, alert Fission for publishing to Nexus.

[node-event-consumer]:https://git.justfab.net/projects/SVC/repos/node-event-producer/browse
[Alexis Emperador]:https://confluence.justfab.net/display/~AEmperador
[Bryan Galaz]:https://confluence.techstyle.net/display/~BGalaz
[docs]:https://confluence.techstyle.net/display/DEVOPS/Setting+up+Git+Repo+for+Publishing+to+Private+NPM+Repo
[Ed Galarza]:https://confluence.techstyle.net/display/~egalarza
[TFG-Publish-To-Nexus-Registry Jenkins Job]:https://jenkins-dev.techstyle.tech/service/tfg-jenkins-dev/job/TFG-Publish-To-Nexus-Registry/